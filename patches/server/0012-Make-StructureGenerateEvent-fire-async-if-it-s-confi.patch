From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Nahuel <nahueldolores@hotmail.com>
Date: Thu, 28 May 2020 21:42:35 -0300
Subject: [PATCH] Make StructureGenerateEvent fire async if it's configured to


diff --git a/src/main/java/net/minecraft/server/ChunkGenerator.java b/src/main/java/net/minecraft/server/ChunkGenerator.java
index bcc02502c589644983badd45b068bb1624f2f495..5f07359cfe39d92d473b9267102a64e4d1f63f41 100644
--- a/src/main/java/net/minecraft/server/ChunkGenerator.java
+++ b/src/main/java/net/minecraft/server/ChunkGenerator.java
@@ -1,6 +1,7 @@
 package net.minecraft.server;
 
 // Papercut start
+import com.destroystokyo.paper.PaperConfig;
 import com.destroystokyo.paper.event.world.StructureGenerateEvent;
 import org.bukkit.StructureType;
 // Papercut end
@@ -176,6 +177,7 @@ public abstract class ChunkGenerator<C extends GeneratorSettingsDefault> {
     // Papercut start
     private StructureStart getStructureStart(BiomeManager biomemanager, ChunkGenerator<?> chunkgenerator, DefinedStructureManager definedstructuremanager, StructureGenerator<?> structuregenerator, int i, SeededRandom seededrandom, ChunkCoordIntPair chunkcoordintpair, StructureStart structurestart1, BiomeBase biomebase) {
         StructureGenerateEvent event = new StructureGenerateEvent(
+                PaperConfig.asyncChunks && !getWorld().getServer().isPrimaryThread(),
                 getWorld().getWorld(),
                 StructureType.getStructureTypes().get(structuregenerator.b().toLowerCase()),
                 chunkcoordintpair.x,
