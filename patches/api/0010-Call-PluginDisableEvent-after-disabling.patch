From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Mariell Hoversholm <proximyst@proximyst.com>
Date: Mon, 13 Jul 2020 12:44:10 +0200
Subject: [PATCH] Call PluginDisableEvent after disabling

---
 src/main/java/org/bukkit/plugin/java/JavaPluginLoader.java | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/main/java/org/bukkit/plugin/java/JavaPluginLoader.java b/src/main/java/org/bukkit/plugin/java/JavaPluginLoader.java
index 384edf9890dfbd1cddfdcac4db1ebe9a4d761f78..307ce2e7d6f71f82573e5b33f0e3a1027eb4384e 100644
--- a/src/main/java/org/bukkit/plugin/java/JavaPluginLoader.java
+++ b/src/main/java/org/bukkit/plugin/java/JavaPluginLoader.java
@@ -406,7 +406,7 @@ public final class JavaPluginLoader implements PluginLoader {
             String message = String.format("Disabling %s", plugin.getDescription().getFullName());
             plugin.getLogger().info(message);
 
-            server.getPluginManager().callEvent(new PluginDisableEvent(plugin));
+            // server.getPluginManager().callEvent(new PluginDisableEvent(plugin)); // Papercut - move down
 
             JavaPlugin jPlugin = (JavaPlugin) plugin;
             ClassLoader cloader = jPlugin.getClassLoader();
@@ -417,6 +417,8 @@ public final class JavaPluginLoader implements PluginLoader {
                 server.getLogger().log(Level.SEVERE, "Error occurred while disabling " + plugin.getDescription().getFullName() + " (Is it up to date?)", ex);
             }
 
+            server.getPluginManager().callEvent(new PluginDisableEvent(plugin)); // Papercut - move down
+
             if (cloader instanceof PluginClassLoader) {
                 PluginClassLoader loader = (PluginClassLoader) cloader;
                 loaders.remove(loader);
